{"remainingRequest":"E:\\console\\web\\node_modules\\babel-loader\\lib\\index.js!E:\\console\\web\\node_modules\\eslint-loader\\index.js??ref--13-0!E:\\console\\web\\src\\utils\\image.js","dependencies":[{"path":"E:\\console\\web\\src\\utils\\image.js","mtime":1629377582278},{"path":"E:\\console\\web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1629377571573},{"path":"E:\\console\\web\\node_modules\\babel-loader\\lib\\index.js","mtime":1629377569839},{"path":"E:\\console\\web\\node_modules\\eslint-loader\\index.js","mtime":1629377574113}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXktYnVmZmVyLmNvbnN0cnVjdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuYXJyYXktYnVmZmVyLnNsaWNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMuZnVuY3Rpb24ubmFtZSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLm9iamVjdC50by1zdHJpbmciOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy5yZWdleHAuZXhlYyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnN0cmluZy5zcGxpdCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnVpbnQ4LWFycmF5IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuY29weS13aXRoaW4iOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5ldmVyeSI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZpbGwiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maWx0ZXIiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5maW5kIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuZmluZC1pbmRleCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LmZvci1lYWNoIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuaW5jbHVkZXMiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5pbmRleC1vZiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5Lml0ZXJhdG9yIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuam9pbiI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5Lmxhc3QtaW5kZXgtb2YiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5tYXAiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5yZWR1Y2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5yZWR1Y2UtcmlnaHQiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5yZXZlcnNlIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc2V0IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc2xpY2UiOwppbXBvcnQgImNvcmUtanMvbW9kdWxlcy9lcy50eXBlZC1hcnJheS5zb21lIjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkuc29ydCI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnN1YmFycmF5IjsKaW1wb3J0ICJjb3JlLWpzL21vZHVsZXMvZXMudHlwZWQtYXJyYXkudG8tbG9jYWxlLXN0cmluZyI7CmltcG9ydCAiY29yZS1qcy9tb2R1bGVzL2VzLnR5cGVkLWFycmF5LnRvLXN0cmluZyI7CmltcG9ydCBfY2xhc3NDYWxsQ2hlY2sgZnJvbSAiRTovY29uc29sZS93ZWIvbm9kZV9tb2R1bGVzL0BiYWJlbC9ydW50aW1lL2hlbHBlcnMvZXNtL2NsYXNzQ2FsbENoZWNrIjsKaW1wb3J0IF9jcmVhdGVDbGFzcyBmcm9tICJFOi9jb25zb2xlL3dlYi9ub2RlX21vZHVsZXMvQGJhYmVsL3J1bnRpbWUvaGVscGVycy9lc20vY3JlYXRlQ2xhc3MiOwoKdmFyIEltYWdlQ29tcHJlc3MgPSAvKiNfX1BVUkVfXyovZnVuY3Rpb24gKCkgewogIGZ1bmN0aW9uIEltYWdlQ29tcHJlc3MoZmlsZSwgZmlsZVNpemUpIHsKICAgIHZhciBtYXhXSCA9IGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIGFyZ3VtZW50c1syXSAhPT0gdW5kZWZpbmVkID8gYXJndW1lbnRzWzJdIDogMTkyMDsKCiAgICBfY2xhc3NDYWxsQ2hlY2sodGhpcywgSW1hZ2VDb21wcmVzcyk7CgogICAgdGhpcy5maWxlID0gZmlsZTsKICAgIHRoaXMuZmlsZVNpemUgPSBmaWxlU2l6ZTsKICAgIHRoaXMubWF4V0ggPSBtYXhXSDsgLy8g5pyA5aSn6ZW/5a69CiAgfQoKICBfY3JlYXRlQ2xhc3MoSW1hZ2VDb21wcmVzcywgW3sKICAgIGtleTogImNvbXByZXNzIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBjb21wcmVzcygpIHsKICAgICAgdmFyIF90aGlzID0gdGhpczsKCiAgICAgIC8vIOWOi+e8qQogICAgICB2YXIgZmlsZVR5cGUgPSB0aGlzLmZpbGUudHlwZTsKICAgICAgdmFyIGZpbGVTaXplID0gdGhpcy5maWxlLnNpemUgLyAxMDI0OwogICAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24gKHJlc29sdmUpIHsKICAgICAgICB2YXIgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTsKICAgICAgICByZWFkZXIucmVhZEFzRGF0YVVSTChfdGhpcy5maWxlKTsKCiAgICAgICAgcmVhZGVyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgIHZhciBjYW52YXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdjYW52YXMnKTsKICAgICAgICAgIHZhciBpbWcgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbWcnKTsKICAgICAgICAgIGltZy5zcmMgPSByZWFkZXIucmVzdWx0OwoKICAgICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKCiAgICAgICAgICAgIHZhciBfZFdIID0gX3RoaXMuZFdIKGltZy53aWR0aCwgaW1nLmhlaWdodCwgX3RoaXMubWF4V0gpOwoKICAgICAgICAgICAgY2FudmFzLndpZHRoID0gX2RXSC53aWR0aDsKICAgICAgICAgICAgY2FudmFzLmhlaWdodCA9IF9kV0guaGVpZ2h0OyAvLyDmuIXnqbrlkI4sIOmHjeWGmeeUu+W4gwoKICAgICAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBjYW52YXMud2lkdGgsIGNhbnZhcy5oZWlnaHQpOwogICAgICAgICAgICBjdHguZHJhd0ltYWdlKGltZywgMCwgMCwgY2FudmFzLndpZHRoLCBjYW52YXMuaGVpZ2h0KTsKICAgICAgICAgICAgdmFyIG5ld0ltZ0RhdGEgPSBjYW52YXMudG9EYXRhVVJMKGZpbGVUeXBlLCAwLjkwKTsgLy8g5Y6L57yp5a696auY5ZCO55qE5Zu+5YOP5aSn5bCPCgogICAgICAgICAgICB2YXIgbmV3SW1nU2l6ZSA9IF90aGlzLmZpbGVTaXplS0IobmV3SW1nRGF0YSk7CgogICAgICAgICAgICBpZiAobmV3SW1nU2l6ZSA+IF90aGlzLmZpbGVTaXplKSB7CiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+WbvueJh+WwuuWvuOWkquWkpyEnICsgZmlsZVNpemUgKyAnID4+ICcgKyBuZXdJbWdTaXplKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgdmFyIGJsb2IgPSBfdGhpcy5kYXRhVVJMdG9CbG9iKG5ld0ltZ0RhdGEsIGZpbGVUeXBlKTsKCiAgICAgICAgICAgIHZhciBuZmlsZSA9IG5ldyBGaWxlKFtibG9iXSwgX3RoaXMuZmlsZS5uYW1lKTsKICAgICAgICAgICAgcmVzb2x2ZShuZmlsZSk7CiAgICAgICAgICB9OwogICAgICAgIH07CiAgICAgIH0pOwogICAgfQogICAgLyoqDQogICAgICog6ZW/5a69562J5q+U57yp5bCPDQogICAgICog5Zu+5YOP55qE5LiA6L65KOmVv+aIluWuvSnkuLrmnIDlpKfnm67moIflgLwNCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZFdIIiwKICAgIHZhbHVlOiBmdW5jdGlvbiBkV0goc3JjVywgc3JjSCwgZE1heCkgewogICAgICB2YXIgZGVmYXVsdHMgPSB7CiAgICAgICAgd2lkdGg6IHNyY1csCiAgICAgICAgaGVpZ2h0OiBzcmNICiAgICAgIH07CgogICAgICBpZiAoTWF0aC5tYXgoc3JjVywgc3JjSCkgPiBkTWF4KSB7CiAgICAgICAgaWYgKHNyY1cgPiBzcmNIKSB7CiAgICAgICAgICBkZWZhdWx0cy53aWR0aCA9IGRNYXg7CiAgICAgICAgICBkZWZhdWx0cy5oZWlnaHQgPSBNYXRoLnJvdW5kKHNyY0ggKiAoZE1heCAvIHNyY1cpKTsKICAgICAgICAgIHJldHVybiBkZWZhdWx0czsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgZGVmYXVsdHMuaGVpZ2h0ID0gZE1heDsKICAgICAgICAgIGRlZmF1bHRzLndpZHRoID0gTWF0aC5yb3VuZChzcmNXICogKGRNYXggLyBzcmNIKSk7CiAgICAgICAgICByZXR1cm4gZGVmYXVsdHM7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBkZWZhdWx0czsKICAgICAgfQogICAgfQogIH0sIHsKICAgIGtleTogImZpbGVTaXplS0IiLAogICAgdmFsdWU6IGZ1bmN0aW9uIGZpbGVTaXplS0IoZGF0YVVSTCkgewogICAgICB2YXIgc2l6ZUtCID0gMDsKICAgICAgc2l6ZUtCID0gTWF0aC5yb3VuZChkYXRhVVJMLnNwbGl0KCcsJylbMV0ubGVuZ3RoICogMyAvIDQgLyAxMDI0KTsKICAgICAgcmV0dXJuIHNpemVLQjsKICAgIH0KICAgIC8qKg0KICAgICAqIOi9rOS4ukJsb2INCiAgICAgKi8KCiAgfSwgewogICAga2V5OiAiZGF0YVVSTHRvQmxvYiIsCiAgICB2YWx1ZTogZnVuY3Rpb24gZGF0YVVSTHRvQmxvYihkYXRhVVJMLCBmaWxlVHlwZSkgewogICAgICB2YXIgYnl0ZVN0cmluZyA9IGF0b2IoZGF0YVVSTC5zcGxpdCgnLCcpWzFdKTsKICAgICAgdmFyIG1pbWVTdHJpbmcgPSBkYXRhVVJMLnNwbGl0KCcsJylbMF0uc3BsaXQoJzonKVsxXS5zcGxpdCgnOycpWzBdOwogICAgICB2YXIgYWIgPSBuZXcgQXJyYXlCdWZmZXIoYnl0ZVN0cmluZy5sZW5ndGgpOwogICAgICB2YXIgaWEgPSBuZXcgVWludDhBcnJheShhYik7CgogICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJ5dGVTdHJpbmcubGVuZ3RoOyBpKyspIHsKICAgICAgICBpYVtpXSA9IGJ5dGVTdHJpbmcuY2hhckNvZGVBdChpKTsKICAgICAgfQoKICAgICAgaWYgKGZpbGVUeXBlKSB7CiAgICAgICAgbWltZVN0cmluZyA9IGZpbGVUeXBlOwogICAgICB9CgogICAgICByZXR1cm4gbmV3IEJsb2IoW2FiXSwgewogICAgICAgIHR5cGU6IG1pbWVTdHJpbmcsCiAgICAgICAgbGFzdE1vZGlmaWVkRGF0ZTogbmV3IERhdGUoKQogICAgICB9KTsKICAgIH0KICB9XSk7CgogIHJldHVybiBJbWFnZUNvbXByZXNzOwp9KCk7CgpleHBvcnQgeyBJbWFnZUNvbXByZXNzIGFzIGRlZmF1bHQgfTs="},{"version":3,"sources":["E:/console/web/src/utils/image.js"],"names":["ImageCompress","file","fileSize","maxWH","fileType","type","size","Promise","resolve","reader","FileReader","readAsDataURL","onload","canvas","document","createElement","img","src","result","ctx","getContext","_dWH","dWH","width","height","clearRect","drawImage","newImgData","toDataURL","newImgSize","fileSizeKB","console","log","blob","dataURLtoBlob","nfile","File","name","srcW","srcH","dMax","defaults","Math","max","round","dataURL","sizeKB","split","length","byteString","atob","mimeString","ab","ArrayBuffer","ia","Uint8Array","i","charCodeAt","Blob","lastModifiedDate","Date"],"mappings":"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","sourcesContent":["export default class ImageCompress {\r\n  constructor(file, fileSize, maxWH = 1920) {\r\n    this.file = file\r\n    this.fileSize = fileSize\r\n    this.maxWH = maxWH // 最大长宽\r\n  }\r\n\r\n  compress() {\r\n    // 压缩\r\n    const fileType = this.file.type\r\n    const fileSize = this.file.size / 1024\r\n    return new Promise(resolve => {\r\n      const reader = new FileReader()\r\n      reader.readAsDataURL(this.file)\r\n      reader.onload = () => {\r\n        const canvas = document.createElement('canvas')\r\n        const img = document.createElement('img')\r\n        img.src = reader.result\r\n        img.onload = () => {\r\n          const ctx = canvas.getContext('2d')\r\n          const _dWH = this.dWH(img.width, img.height, this.maxWH)\r\n          canvas.width = _dWH.width\r\n          canvas.height = _dWH.height\r\n\r\n          // 清空后, 重写画布\r\n          ctx.clearRect(0, 0, canvas.width, canvas.height)\r\n          ctx.drawImage(img, 0, 0, canvas.width, canvas.height)\r\n\r\n          const newImgData = canvas.toDataURL(fileType, 0.90)\r\n\r\n          // 压缩宽高后的图像大小\r\n          const newImgSize = this.fileSizeKB(newImgData)\r\n\r\n          if (newImgSize > this.fileSize) {\r\n            console.log('图片尺寸太大!' + fileSize + ' >> ' + newImgSize)\r\n          }\r\n\r\n          const blob = this.dataURLtoBlob(newImgData, fileType)\r\n          const nfile = new File([blob], this.file.name)\r\n          resolve(nfile)\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  /**\r\n   * 长宽等比缩小\r\n   * 图像的一边(长或宽)为最大目标值\r\n   */\r\n  dWH(srcW, srcH, dMax) {\r\n    const defaults = {\r\n      width: srcW,\r\n      height: srcH\r\n    }\r\n    if (Math.max(srcW, srcH) > dMax) {\r\n      if (srcW > srcH) {\r\n        defaults.width = dMax\r\n        defaults.height = Math.round(srcH * (dMax / srcW))\r\n        return defaults\r\n      } else {\r\n        defaults.height = dMax\r\n        defaults.width = Math.round(srcW * (dMax / srcH))\r\n        return defaults\r\n      }\r\n    } else {\r\n      return defaults\r\n    }\r\n  }\r\n\r\n  fileSizeKB(dataURL) {\r\n    let sizeKB = 0\r\n    sizeKB = Math.round((dataURL.split(',')[1].length * 3 / 4) / 1024)\r\n    return sizeKB\r\n  }\r\n\r\n  /**\r\n   * 转为Blob\r\n   */\r\n  dataURLtoBlob(dataURL, fileType) {\r\n    const byteString = atob(dataURL.split(',')[1])\r\n    let mimeString = dataURL.split(',')[0].split(':')[1].split(';')[0]\r\n    const ab = new ArrayBuffer(byteString.length)\r\n    const ia = new Uint8Array(ab)\r\n    for (let i = 0; i < byteString.length; i++) {\r\n      ia[i] = byteString.charCodeAt(i)\r\n    }\r\n    if (fileType) {\r\n      mimeString = fileType\r\n    }\r\n    return new Blob([ab], { type: mimeString, lastModifiedDate: new Date() })\r\n  }\r\n}\r\n"]}]}