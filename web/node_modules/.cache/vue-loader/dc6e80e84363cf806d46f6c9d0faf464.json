{"remainingRequest":"E:\\console\\web\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\console\\web\\src\\view\\superAdmin\\authority\\components\\menus.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\console\\web\\src\\view\\superAdmin\\authority\\components\\menus.vue","mtime":1625854608000},{"path":"E:\\console\\web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\console\\web\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\console\\web\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\console\\web\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdldEJhc2VNZW51VHJlZSwgZ2V0TWVudUF1dGhvcml0eSwgYWRkTWVudUF1dGhvcml0eSB9IGZyb20gJ0AvYXBpL21lbnUnCmltcG9ydCB7CiAgdXBkYXRlQXV0aG9yaXR5Cn0gZnJvbSAnQC9hcGkvYXV0aG9yaXR5JwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ01lbnVzJywKICBwcm9wczogewogICAgcm93OiB7CiAgICAgIGRlZmF1bHQ6IGZ1bmN0aW9uKCkgewogICAgICAgIHJldHVybiB7fQogICAgICB9LAogICAgICB0eXBlOiBPYmplY3QKICAgIH0KICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBtZW51VHJlZURhdGE6IFtdLAogICAgICBtZW51VHJlZUlkczogW10sCiAgICAgIG5lZWRDb25maXJtOiBmYWxzZSwKICAgICAgbWVudURlZmF1bHRQcm9wczogewogICAgICAgIGNoaWxkcmVuOiAnY2hpbGRyZW4nLAogICAgICAgIGxhYmVsOiBmdW5jdGlvbihkYXRhKSB7CiAgICAgICAgICByZXR1cm4gZGF0YS5tZXRhLnRpdGxlCiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwKICBhc3luYyBjcmVhdGVkKCkgewogICAgLy8g6I635Y+W5omA5pyJ6I+c5Y2V5qCRCiAgICBjb25zdCByZXMgPSBhd2FpdCBnZXRCYXNlTWVudVRyZWUoKQogICAgdGhpcy5tZW51VHJlZURhdGEgPSByZXMuZGF0YS5tZW51cwoKICAgIGNvbnN0IHJlczEgPSBhd2FpdCBnZXRNZW51QXV0aG9yaXR5KHsgYXV0aG9yaXR5SWQ6IHRoaXMucm93LmF1dGhvcml0eUlkIH0pCiAgICBjb25zdCBtZW51cyA9IHJlczEuZGF0YS5tZW51cwogICAgY29uc3QgYXJyID0gW10KICAgIG1lbnVzLm1hcChpdGVtID0+IHsKICAgICAgLy8g6Ziy5q2i55u05o6l6YCJ5Lit54i257qn6YCg5oiQ5YWo6YCJCiAgICAgIGlmICghbWVudXMuc29tZShzYW1lID0+IHNhbWUucGFyZW50SWQgPT09IGl0ZW0ubWVudUlkKSkgewogICAgICAgIGFyci5wdXNoKE51bWJlcihpdGVtLm1lbnVJZCkpCiAgICAgIH0KICAgIH0pCiAgICB0aGlzLm1lbnVUcmVlSWRzID0gYXJyCiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBzZXREZWZhdWx0KGRhdGEpIHsKICAgICAgY29uc3QgcmVzID0gYXdhaXQgdXBkYXRlQXV0aG9yaXR5KHsgYXV0aG9yaXR5SWQ6IHRoaXMucm93LmF1dGhvcml0eUlkLCBBdXRob3JpdHlOYW1lOiB0aGlzLnJvdy5hdXRob3JpdHlOYW1lLCBwYXJlbnRJZDogdGhpcy5yb3cucGFyZW50SWQsIGRlZmF1bHRSb3V0ZXI6IGRhdGEubmFtZSB9KQogICAgICBpZiAocmVzLmNvZGUgPT09IDApIHsKICAgICAgICB0aGlzLiRtZXNzYWdlKHsgdHlwZTogJ3N1Y2Nlc3MnLCBtZXNzYWdlOiAn6K6+572u5oiQ5YqfJyB9KQogICAgICAgIHRoaXMucm93LmRlZmF1bHRSb3V0ZXIgPSByZXMuZGF0YS5hdXRob3JpdHkuZGVmYXVsdFJvdXRlcgogICAgICB9CiAgICB9LAogICAgbm9kZUNoYW5nZSgpIHsKICAgICAgdGhpcy5uZWVkQ29uZmlybSA9IHRydWUKICAgIH0sCiAgICAvLyDmmrTpnLLnu5nlpJblsYLkvb/nlKjnmoTliIfmjaLmi6bmiKrnu5/kuIDmlrnms5UKICAgIGVudGVyQW5kTmV4dCgpIHsKICAgICAgdGhpcy5yZWxhdGlvbigpCiAgICB9LAogICAgLy8g5YWz6IGU5qCRIOehruiupOaWueazlQogICAgYXN5bmMgcmVsYXRpb24oKSB7CiAgICAgIGNvbnN0IGNoZWNrQXJyID0gdGhpcy4kcmVmcy5tZW51VHJlZS5nZXRDaGVja2VkTm9kZXMoZmFsc2UsIHRydWUpCiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGFkZE1lbnVBdXRob3JpdHkoewogICAgICAgIG1lbnVzOiBjaGVja0FyciwKICAgICAgICBhdXRob3JpdHlJZDogdGhpcy5yb3cuYXV0aG9yaXR5SWQKICAgICAgfSkKICAgICAgaWYgKHJlcy5jb2RlID09PSAwKSB7CiAgICAgICAgdGhpcy4kbWVzc2FnZSh7CiAgICAgICAgICB0eXBlOiAnc3VjY2VzcycsCiAgICAgICAgICBtZXNzYWdlOiAn6I+c5Y2V6K6+572u5oiQ5YqfIScKICAgICAgICB9KQogICAgICB9CiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["menus.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"menus.vue","sourceRoot":"src/view/superAdmin/authority/components","sourcesContent":["<template>\n  <div>\n    <div class=\"clearflex\">\n      <el-button class=\"fl-right\" size=\"small\" type=\"primary\" @click=\"relation\">确 定</el-button>\n    </div>\n    <el-tree\n      ref=\"menuTree\"\n      :data=\"menuTreeData\"\n      :default-checked-keys=\"menuTreeIds\"\n      :props=\"menuDefaultProps\"\n      default-expand-all\n      highlight-current\n      node-key=\"ID\"\n      show-checkbox\n      @check=\"nodeChange\"\n    >\n      <span slot-scope=\"{ node , data }\" class=\"custom-tree-node\">\n        <span>{{ node.label }}</span>\n        <span>\n          <el-button\n            type=\"text\"\n            size=\"mini\"\n            :style=\"{color:row.defaultRouter === data.name?'#E6A23C':'#85ce61'}\"\n            :disabled=\"!node.checked\"\n            @click=\"() => setDefault(data)\"\n          >\n            {{ row.defaultRouter === data.name?\"首页\":\"设为首页\" }}\n          </el-button>\n        </span>\n      </span>\n    </el-tree>\n  </div>\n</template>\n\n<script>\nimport { getBaseMenuTree, getMenuAuthority, addMenuAuthority } from '@/api/menu'\nimport {\n  updateAuthority\n} from '@/api/authority'\nexport default {\n  name: 'Menus',\n  props: {\n    row: {\n      default: function() {\n        return {}\n      },\n      type: Object\n    }\n  },\n  data() {\n    return {\n      menuTreeData: [],\n      menuTreeIds: [],\n      needConfirm: false,\n      menuDefaultProps: {\n        children: 'children',\n        label: function(data) {\n          return data.meta.title\n        }\n      }\n    }\n  },\n  async created() {\n    // 获取所有菜单树\n    const res = await getBaseMenuTree()\n    this.menuTreeData = res.data.menus\n\n    const res1 = await getMenuAuthority({ authorityId: this.row.authorityId })\n    const menus = res1.data.menus\n    const arr = []\n    menus.map(item => {\n      // 防止直接选中父级造成全选\n      if (!menus.some(same => same.parentId === item.menuId)) {\n        arr.push(Number(item.menuId))\n      }\n    })\n    this.menuTreeIds = arr\n  },\n  methods: {\n    async setDefault(data) {\n      const res = await updateAuthority({ authorityId: this.row.authorityId, AuthorityName: this.row.authorityName, parentId: this.row.parentId, defaultRouter: data.name })\n      if (res.code === 0) {\n        this.$message({ type: 'success', message: '设置成功' })\n        this.row.defaultRouter = res.data.authority.defaultRouter\n      }\n    },\n    nodeChange() {\n      this.needConfirm = true\n    },\n    // 暴露给外层使用的切换拦截统一方法\n    enterAndNext() {\n      this.relation()\n    },\n    // 关联树 确认方法\n    async relation() {\n      const checkArr = this.$refs.menuTree.getCheckedNodes(false, true)\n      const res = await addMenuAuthority({\n        menus: checkArr,\n        authorityId: this.row.authorityId\n      })\n      if (res.code === 0) {\n        this.$message({\n          type: 'success',\n          message: '菜单设置成功!'\n        })\n      }\n    }\n  }\n}\n</script>\n"]}]}